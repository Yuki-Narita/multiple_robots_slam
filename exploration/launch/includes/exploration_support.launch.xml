<launch>
    <arg name="frontier_detection"/>
    <arg name="branch_detection"/>
    <arg name="map_fill"/>
    <arg name="frontier_from_costmap" default="true"/>

    <arg name="orig_map" default="map"/>
    <arg name="orig_costmap" default="move_base/global_costmap/costmap"/>
    <arg name="fill_map" default="fill_map"/>
    <arg name="fill_costmap" default="fill_costmap"/>

    <!-- frontier_detection -->
    <node if="$(arg frontier_detection)" pkg="exploration_support" type="frontier_detection" name="frontier_detection">
        <!-- <remap if="$(arg map_fill)" from="map" to="$(arg fill_map)"/>
        <remap unless="$(arg map_fill)" from="map" to="$(arg orig_map)"/> -->
        <remap if="$(eval arg('map_fill') and arg('frontier_from_costmap'))" from="map" to="$(arg fill_costmap)"/>
        <remap if="$(eval arg('map_fill') and not arg('frontier_from_costmap'))" from="map" to="$(arg fill_map)"/>
        <remap if="$(eval not arg('map_fill') and not arg('frontier_from_costmap'))" from="map" to="$(arg orig_map)"/>
        <remap if="$(eval not arg('map_fill') and arg('frontier_from_costmap'))" from="map" to="$(arg orig_costmap)"/>
        <param name="frontier_parameter_file_path" value="$(find exploration_support)/param/frontier_last_parameters.yaml"/>
        <rosparam file="$(find exploration_support)/param/frontier_last_parameters.yaml" command="load"/>
    </node>

    <!-- branch_detection -->
    <node if="$(arg branch_detection)" pkg="exploration_support" type="branch_detection" name="branch_detection">
        <param name="branch_parameter_file_path" value="$(find exploration_support)/param/branch_last_parameters.yaml"/>
        <rosparam file="$(find exploration_support)/param/branch_last_parameters.yaml" command="load"/>
    </node>

    <!-- map_fill -->
    <node if="$(arg map_fill)" pkg="exploration_support" type="map_fill" name="map_fill">
        <remap from="map" to="$(arg orig_map)"/>
        <remap from="fill_map" to="$(arg fill_map)"/>
        <param name="fill_parameter_file_path" value="$(find exploration_support)/param/map_fill_last_parameters.yaml"/>
        <rosparam file="$(find exploration_support)/param/map_fill_last_parameters.yaml" command="load"/>
    </node>

    <!-- costmap_fill -->
    <node if="$(arg map_fill)" pkg="exploration_support" type="map_fill" name="costmap_fill">
        <remap from="map" to="$(arg orig_costmap)"/>
        <remap from="fill_map" to="$(arg fill_costmap)"/>
        <param name="fill_parameter_file_path" value="$(find exploration_support)/param/costmap_fill_last_parameters.yaml"/>
        <rosparam file="$(find exploration_support)/param/costmap_fill_last_parameters.yaml" command="load"/>
    </node>

    <!-- exploration_manager -->
    <node pkg="exploration_support" type="exploration_manager" name="exploration_manager">
        <remap if="$(arg map_fill)" from="map" to="$(arg fill_map)"/>
        <remap unless="$(arg map_fill)" from="map" to="$(arg orig_map)"/>
        <param name="area_rate" value="1.0"/>
        <param name="end_time" value="36000000"/>
        <param name="exmng_parameter_file_path" value="$(find exploration_support)/param/exmng_last_parameters.yaml"/>
        <rosparam file="$(find exploration_support)/param/exmng_last_parameters.yaml" command="load"/>
    </node>

    <!-- robot_manager -->
    <node pkg="exploration_support" type="robot_manager" name="robot_manager">
        <param name="pose_log_rate" value="1.0"/>
    </node>

    <!-- bumper_continuity -->
    <node pkg="exploration_support" type="bumper_continuity" name="bumper_continuity"/>

    <!-- visualization -->
    <node pkg="exploration_support" type="visualization" name="visualization"/>
</launch>